# Nordic nRF5 TestTask

Тестовое задание на процессоре **Nordic nRF52840** на отладочной плате **nRF52840-DK** с использованием  **i2c**, **i2s**, **ble**.

## Подключение периферии

Питание всей периферии подключено от **3.3** вольт.

| Периферия    | Название | Интерфейс | Функция    | Пин   |
| ------------ | -------- | --------- | ---------- | ----- |
| Акселерометр | BMA280   | I2C       | SDA        | P0.26 |
|              |          |           | SCL        | P0.27 |
| Аудио ЦАП    | NAU8315  | I2S       | SDA (DA)   | P0.29 |
|              |          |           | LRCLK (FS) | P0.30 |
|              |          |           | SCK (B)    | P0.31 |

## Описание модулей

### Акселерометр

Инициализация акселерометра происходит из суперцикла в State-машине.
Таким образом одновременно можно выполнять другие задачи.

#### Управление

| Кнопка  | Функция                               |
| ------- | ------------------------------------- |
| Button1 | Чтение показаний и передача их по BLE |

### Аудио плеер

Плеер имеет 2 коротеньких трека.
- Luke Bond - U
- Purple Haze - Bergen

Треки были конвертированы в **wav** с помощью ffmpeg под **16000** bit/s

> Используется только **правый** канал, так как данный ЦАП может воспроизводить **всего 1 канал**.

#### Управление с использованием кнопок

| Кнопка  | Функция      |
| ------- | ------------ |
| Button2 | Play         |
| Button3 | Pause/Resume |
| Button4 | Stop         |

#### Управление по BLE

Сервис имеет характеристику **Read** и **Write**

| Байт    | Функция      |
| ------- | ------------ |
| 0x01    | Play Track 1 |
| 0x02    | Play Track 2 |
| 0x03    | Stop         |


### Bluetooth

Реализован сервис **ble** с двумя характеристикам, соответствующими ТЗ.
Вещание **ble** выполняется таким образом, **1 сек** вещание, **4 сек** простой.
Таким образом достигаем периодичность **5 сек**.

### Индикация

| Индикатор | Модуль        | Режим     | Описание   |
| --------- | ------------- | --------- | ---------- |
| LED1      | Application   | Включен   | Устройство находится в Sleep Mode |
|           |               | Мигает    | Устройство работает в обычном режиме |
| LED2      | Bluetooth     | Включен   | Подключено устройство по Bluetooth |
|           |               | Выключен  | Bluetooth в состоянии простоя |
|           |               | Мигает    | Выполняется вещание по по Bluetooth |
| LED3      | Accelerometer | Выключен  | Пользовательские действия с акселерометром не выполняются |
|           |               | Мигает    | Выполняется чтение данных с акселеромтера |
| LED4      | Audio Player  | Включен   | Плеер в состоянии Паузы |
|           |               | Выключен  | Плеер в состоянии Остановлен |
|           |               | Мигает    | Плеер в состоянии Прогирывания музыки |
